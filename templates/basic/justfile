# -*-Makefile-*-

test:
  just run --beam-on 10

build:
  cmake -S src -B build/app
  cmake --build build/app

run *ARGS: build
  #!/usr/bin/env sh
  # CHANGEME-my-n4-app: change my-n4-app with a name that better suits your
  # project. At the same time you must change it in the `src/CMakeLists.txt`.
  just run-dispatch-vis-cli ./build/app/my-n4-app {{ARGS}}
  exit $?

clean:
  rm build -rf

run-dispatch-vis-system *COMMAND:
  #!/usr/bin/env sh
  sh execute-with-nixgl-if-needed-by-system.sh {{COMMAND}}

run-dispatch-vis-cli *COMMAND:
  #!/usr/bin/env sh
  gui=$(echo "{{COMMAND}}" | grep -E "\-\-vis\-macro | \-g")
  if [ -z "$gui" ]; then
      {{COMMAND}}
  else
      just run-dispatch-vis-system {{COMMAND}}
  fi
